# Итоговый проект 3 модуля по дисциплине "ETL-процессы"

## Основные компоненты

1. База данных **source** (MongoDB), данные для которой сгенерированы python-скриптом
2. База данных **target** (Postgresql), наполняемая преобразованными данными из source
3. ETL-движок на базе **Apache Airflow**, с помощью которого осуществляется репликация данных

### 1. Содержание базы-источника

Состоит из нескольких сущностей, которые описывают работу интернет-магазина со своей системой рекомендаций, службой поддержки и публикацией только проверенных отзывов:

1. **user_sessions**, сессии пользователей:
    - session_id — уникальный идентификатор сессии;
    - user_id — идентификатор пользователя;
    - start_time — время начала сессии;
    - end_time — время завершения сессии;
    - pages_visited — массив посещённых страниц;
    - device — информация об устройстве;
    - actions — массив действий пользователя.

2. **product_price_history**, история изменения цен:
    - product_id — идентификатор товара;
    - price_changes — массив изменений цен с датами;
    - current_price — текущая цена;
    - currency — валюта.

3. **event_logs**, логи событий:
    - event_id — уникальный идентификатор события;
    - timestamp — время события;
    - event_type — тип события;
    - details — подробности.

4. **support_tickets**, обращения в поддержку:
    - ticket_id — уникальный идентификатор тикета;
    - user_id — идентификатор пользователя;
    - status — статус тикета;
    - issue_type — тип проблемы;
    - messages — массив сообщений;
    - created_at — время создания тикета;
    - updated_at — время последнего обновления.

5. **user_recommendations**, рекомендации пользователям:
    - user_id — идентификатор пользователя;
    - recommended_products — массив рекомендованных товаров;
    - last_updated — время последнего обновления рекомендаций.

6. **moderation_queue**, очередь модерации отзывов:
    - review_id — идентификатор отзыва;
    - user_id — идентификатор пользователя;
    - product_id — идентификатор товара;
    - review_text — текст отзыва;
    - rating — оценка;
    - moderation_status — статус модерации;
    - flags — массив флагов;
    - submitted_at — время, когда был оставлен отзыв.

7. **search_queries**, поисковые запросы:
    - query_id — уникальный идентификатор запроса;
    - user_id — идентификатор пользователя;
    - query_text — текст запроса;
    - timestamp — время запроса;
    - filters — применённые фильтры;
    - results_count — количество найденных результатов.

### Репликация данных

Осуществляется с помощью DAG-ов Airflow. Состоит из двух этапов - выгрузка из *source* и загрузка в *target*, предварительно перед загрузкой осуществляется приведение дат к типу datetime.

Ниже представлен непосредственный список дагов (таблица выгрузки совпадает с таблицей загрузки):

1. **load_user_sessions** - отвечает за выгрузку user_sessions

2. **load_product_price_history** - отвечает за выгрузку product_price_history

3. **load_events_log** - отвечает за выгрузку events_log

4. **load_support_tickets** - отвечает за выгрузку support_tickets

5. **load_user_recommendations** - отвечает за выгрузку user_recommendations

6. **load_moderation_queue** - отвечает за выгрузку moderation_queue

7. **load_search_queries** - отвечает за выгрузку search_queries